#!/usr/bin/with-contenv bash
# shellcheck shell=bash
# Copyright (c) 2019, PhysK
# All rights reserved.
## function source
function log() {
echo "[Uploader] ${1}"
}
DISABLE_UNIONFS_CHOWN=${DISABLE_UNIONFS_CHOWN:-false}
log "-> Making sure we have the correct Directorys <-"
mkdir -p /mnt/tdrive1 \
         /mnt/tdrive2 \
         /mnt/gdrive \
         /mnt/gcrypt
log "-> Setting Permissions || start <-"
chown -hR abc:abc  \
         /config \
         /mnt \
         /move
chmod a+x /app/gdrive/uploader.sh \
         /app/tdrive/uploader.sh \
         /app/uploader/upload.sh \
         /app/functions/functions.sh \
         /app/update-alpine/update-alpine.sh \
         /app/mergerfs.sh
chown -hR abc:abc /app/uploader/upload.sh \
         /app/gdrive/uploader.sh \
         /app/tdrive/uploader.sh \
         /app/functions/functions.sh \
         /app/update-alpine/update-alpine.sh \
         /app/mergerfs.sh
chown -R abc:abc /run \
         /var/lib/nginx \
         /var/log/nginx \
         /var/www
log "-> Setting Permissions || done <-"
if [ "${DISABLE_UNIONFS_CHOWN}" == "false" ]; then
    chown -hR abc:abc /unionfs
else
    log "-> Unionfs Chown disabled <-"
fi
